{{>header_autogen}}

unit {{classname}}.Rest;

interface

uses
  System.SysUtils,
  whizaxe.rest.CommandHandler,
  whizaxe.http.types,
  whizaxe.rest.Request,
  {{classname}}Interface;

type
{{#operations}}

  {$RTTI EXPLICIT METHODS([vcPublic])}
  T{{classname}}Rest = class
  private
    FApi: I{{classname}};
  public
    {{#operation}}
    /// Operation {{{operationId}}}
    /// <summary>{{{summary}}}</summary>{{#remarks}}
    /// <remarks>{{.}}</remarks>{{/remarks}} 
    {{#allParams}}   
    /// {{paramName}}: {{description}} {{#required}}(required){{/required}}{{^required}}(optional{{#defaultValue}}, default to {{{.}}}{{/defaultValue}}){{/required}}{{#isDeprecated}} (deprecated){{/isDeprecated}}
    {{/allParams}}
    [RestApi('{{httpMethod}}', '{{{path}}}')]
    procedure {{operationId}}(ARequest: TRestRequest; var AResult: THTTPResult){{#isDeprecated}} @deprecated{{/isDeprecated}};
    
    {{/operation}}
    
    constructor Create();
  end;

implementation

uses
  Generics.Collections,
  whizaxe.serialization,
  {{classname}}{{#imports}}{{#-first}},{{/-first}}
  {{{import}}}{{^-last}},{{/-last}}{{/imports}};
  
{ T{{classname}} }

constructor T{{classname}}Rest.Create;
begin
  FAPi := T{{classname}}.Create;
end;

{{#operation}}
procedure T{{classname}}Rest.{{operationId}}(ARequest: TRestRequest; var AResult: THTTPResult);
{{#vendorExtensions.x-codegen-delphi-needs-var}}
var
{{/vendorExtensions.x-codegen-delphi-needs-var}}
{{#allParams}}
  {{paramName}}: {{{dataType}}};
{{/allParams}}
  {{#returnType}}responseObj: {{{.}}};{{/returnType}}
begin
{{#pathParams}}
  {{paramName}} := ARequest.GetPathParam<{{{dataType}}}>('{{paramName}}', '{{defaultValue}}', {{required}});
{{/pathParams}}
{{#bodyParam}}
  {{paramName}} := ARequest.GetBodyParam<{{{dataType}}}>({{required}});
{{/bodyParam}}
{{#queryParams}}
  {{paramName}} := ARequest.GetQueryParam<{{{dataType}}}>('{{paramName}}', '{{defaultValue}}', {{required}});
{{/queryParams}}
{{#headerParams}}
  {{paramName}} := ARequest.GetHeaderParam<{{{dataType}}}>('{{paramName}}', '{{defaultValue}}', {{required}});
{{/headerParams}}
{{#returnType}}
  responseObj := FApi.{{operationId}}({{#allParams}}{{paramName}}{{^-last}}, {{/-last}}{{/allParams}});
  AResult.SetResult(hs2xx_OK, TSerializer.ObjectToJSON(responseObj), 'OK');
{{/returnType}}
{{^returnType}}
  FApi.{{operationId}}({{#allParams}}{{paramName}}{{^-last}}, {{/-last}}{{/allParams}});
  AResult.SetResult(hs2xx_OK, '', 'OK');
{{/returnType}}
end;

{{/operation}}

  
{{/operations}}
end.
